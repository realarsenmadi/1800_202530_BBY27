<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SureSpot</title>
    <meta name="comp1800 template" content="My 1800 App" />

    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- MapLibre GL JS -->
    <link
      href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

    <!-- Last Updated Script-->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

      // Firebase config comes from Vite env vars
      const firebaseConfig = {
        apiKey: "AIzaSyAd0iAXvrTIIo6EaW-_30F_bozEXe8nCTw",
        authDomain: "bby-27.firebaseapp.com",
        projectId: "bby-27",
        appId: "1:628477978363:web:46de11f637c1766419725e"
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function loadLastUpdated() {
        const ref = doc(db, "meta", "lastUpdated");
        const snap = await getDoc(ref);

        const display = document.getElementById("lastUpdatedDisplay");

        if (snap.exists()) {
          const ts = snap.data().time.toDate();
          display.textContent = "Last updated: " + ts.toLocaleString();
        } else {
          display.textContent = "Last updated: unknown";
        }
      }

      document.addEventListener("DOMContentLoaded", loadLastUpdated);
    </script>

    <!-- Link to your styles -->
    <link rel="stylesheet" href="./styles/style.css" />
  </head>

  <body class="main-page">
    <!-- Navigation bar -->
    <nav class="navbar">
      <div>
        <!--Last Updated-->
        <div id="lastUpdatedDisplay">Last updated:â€¦</div>
      </div>
      <div>
        <a href="#">
          <img src="./images/home_icon.png" alt="Home Icon" class="home-icon" />
        </a>
      </div>
    </nav>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Filters, My Location & Search (floating above map) -->
    <div class="search-functions">
      <!-- Filters -->
      <div>
        <img src="./images/Filters.png" alt="Filter Icon" class="filter-icon" />
      </div>

      <!-- ðŸ“ My Location -->
      <div>
        <img
          src="./images/Location.png"
          alt="My Location Button"
          class="location-button"
          id="locateBtn"
        />
        <caption>My Location</caption>
      </div>

      <!-- Search -->
      <div>
        <img
          src="./images/Search.png"
          alt="Search Button"
          class="search-button"
          id="searchBtn"
        />
      </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Search Location</h3>
          <button id="closeModal">&times;</button>
        </div>

        <div class="search-input-container">
          <input
            type="text"
            id="locationInput"
            placeholder="Enter address or place name..."
          />
        </div>

        <div id="searchResults"></div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <nav class="bottom-nav">
        <div>
          <a href="profile.html">
            <img
              src="./images/Profile.png"
              alt="Profile Icon"
              class="profile-icon"
            />
          </a>
        </div>
        <div>
          <a href="favourites.html">
            <img
              src="./images/Favourites.png"
              alt="Favourites Icon"
              class="favourites-icon"
            />
          </a>
        </div>
        <div>
          <a href="faq.html">
            <img src="./images/Help.png" alt="Help Icon" class="help-icon" />
          </a>
        </div>
      </nav>
    </footer>
    <script src="/src/main.js"></script>  
  </body>
</html>
